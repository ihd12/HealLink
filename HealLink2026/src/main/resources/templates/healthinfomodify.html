<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>건강 정보 수정</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="p-5">
<div class="container">
    <h2>건강 정보 수정</h2>
    <hr>

    <form id="modifyForm">
        <input type="hidden" id="healthinfoId" th:value="${healthInfo.id}">

        <div class="form-group">
            <label for="title" class="font-weight-bold">제목</label>
            <input type="text" class="form-control" id="title" th:value="${healthInfo.title}" required>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label class="font-weight-bold">카테고리</label><br>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="category" id="cat1" value="PUBLIC_CENTER"
                               th:checked="${healthInfo.category == 'PUBLIC_CENTER'}">
                        <label class="form-check-label" for="cat1">보건소 소식</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="category" id="cat2" value="VACCINATION_CHECKUP"
                               th:checked="${healthInfo.category == 'VACCINATION_CHECKUP'}">
                        <label class="form-check-label" for="cat2">예방접종/검진</label>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    <label class="font-weight-bold">출처 타입</label><br>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sourceType" id="src1" value="PUBLIC_CENTER"
                               th:checked="${healthInfo.sourceType == 'PUBLIC_CENTER'}">
                        <label class="form-check-label" for="src1">보건소</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sourceType" id="src2" value="MEDICAL_SITE"
                               th:checked="${healthInfo.sourceType == 'MEDICAL_SITE'}">
                        <label class="form-check-label" for="src2">의료기관</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="content" class="font-weight-bold">내용</label>
            <textarea class="form-control bg-light" id="content" rows="10" th:text="${healthInfo.content}" required></textarea>
        </div>

        <div class="text-right">
            <button type="button" class="btn btn-primary" onclick="updateData()">수정 완료</button>
            <a th:href="@{/healthinfo/{id}(id=${healthInfo.id})}" class="btn btn-outline-secondary">취소</a>
        </div>
    </form>
</div>

<script>
    function updateData() {
        const id = document.getElementById('healthinfoId').value;
        const category = document.querySelector('input[name="category"]:checked').value;
        const sourceType = document.querySelector('input[name="sourceType"]:checked').value;

        const postData = {
            title: document.getElementById('title').value,
            content: document.getElementById('content').value,
            category: category,
            sourceType: sourceType
        };

        if(!postData.title || !postData.content) {
            alert("제목과 내용을 입력해주세요.");
            return;
        }

        // Axios PUT 요청으로 데이터 수정
        axios.put('/api/healthinfo/' + id, postData)
            .then(res => {
                alert("성공적으로 수정되었습니다!");
                location.href = "/healthinfo/" + id; // 수정 후 상세조회 화면으로 이동
            })
            .catch(err => {
                console.error(err);
                alert("수정 중 에러가 발생했습니다.");
            });
    }
</script>
</body>
</html>